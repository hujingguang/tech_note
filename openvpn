
OpenVPN  一款强大的开源VPN实现工具，使用openssl作为加密工具。

1. 安装 yum install openvpn  -y   . 

2. 下载easy-rsa生成ca server 证书密钥对,client证书密钥对。
    
    地址： https://github.com/OpenVPN

   模式有 server 模式  client to client 模式， 如果要支持多客户端，在服务器配置中禁用client to client。主要通过 tun虚拟网卡模式进行数据传输。

3. 客户端和服务端进行证书的双向认证，通过CA根证书进行验证，而不用读取各自的证书，如果通过CA证书认证，则接受来自客户端的请求建立链接。

4.  名词解析

    .crq ：为证书请求文件，由openssl 在生成私钥的同时生成该文件，包含了公钥等信息

    .crt:  为证书文件， 由openssl 根据ca证书,用户的crq文件进行生成，包含了公钥，域名，过期时间等信息。

    .key: 为私钥文件。

    .dh : 交换密钥时算法需要用的字符串


5.证书密钥生成。
   
    cd  easy_rsa    

    ./pkitool --help 




6. 客户端版本和服务器端版本需一致，  iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE

server.conf 配置如下：

local 192.168.10.238
port 1194
proto udp
dev tun
ca /etc/openvpn/ca.crt
cert /etc/openvpn/server1.crt
key /etc/openvpn/server1.key  # This file should be kept secret
dh /etc/openvpn/dh2048.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist /etc/openvpn/ipp.txt
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 114.114.114.114"
keepalive 10 120
cipher AES-256-CBC
persist-key
persist-tun
status /tmp/openvpn-status.log
log         /tmp/openvpn.log
verb 3
explicit-exit-notify 1



client配置如下：

client
dev tun
proto udp
remote 192.168.10.238 1194 
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt 
cert client1.crt
key client1.key
comp-lzo
verb 3



参考文档：  
     
    https://www.jianshu.com/p/4bbf946222d5
